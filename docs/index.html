<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Public Comment Opportunities Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <style>
    html, body { margin: 0; height: 100%; }
    #map { width: 100%; height: 100%; }
    .mapboxgl-popup { max-width: 320px; }
    .mapboxgl-popup-content {
      font: 12px/1.4 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
    .legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: white;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .legend span {
      display: inline-block;
      width: 12px; height: 12px;
      margin-right: 6px;
      vertical-align: middle;
    }
    .blm { background: #06b6d4; }
    .usfs { background: #22c55e; }
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend">
  <div><span class="blm"></span>BLM</div>
  <div><span class="usfs"></span>USFS</div>
</div>

<script>
  // ðŸ”‘ Replace this with your own Mapbox public token
  mapboxgl.accessToken = "YOUR_MAPBOX_ACCESS_TOKEN";

  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/light-v11",
    center: [-105.5, 39.0], // start view over Colorado
    zoom: 5
  });

  map.addControl(new mapboxgl.NavigationControl());

  // Path relative to docs/index.html
  const DATA_URL = "data/final_opportunities.geojson";

  map.on("load", () => {
    fetch(DATA_URL)
      .then(r => r.json())
      .then(data => {
        map.addSource("opps", {
          type: "geojson",
          data: data
        });

        map.addLayer({
          id: "opps-layer",
          type: "circle",
          source: "opps",
          paint: {
            "circle-radius": 6,
            "circle-color": [
              "match",
              ["get", "source"],
              "BLM", "#06b6d4",
              "USFS", "#22c55e",
              "#aaa"
            ],
            "circle-stroke-color": "#000",
            "circle-stroke-width": 1
          }
        });

        // Popup on click
        map.on("click", "opps-layer", (e) => {
          const f = e.features[0];
          const p = f.properties;
          const html = `
            <strong>${p.project_name || "(unnamed)"}</strong><br>
            <em>${p.source}</em><br>
            Start: ${p.start_date || "?"}<br>
            End: ${p.end_date || "?"}<br>
            <div style="margin-top:6px;">${(p.notes || "").slice(0,400)}</div>
          `;
          new mapboxgl.Popup({ offset: 12 })
            .setLngLat(e.lngLat)
            .setHTML(html)
            .addTo(map);
        });

        // Change cursor
        map.on("mouseenter", "opps-layer", () => { map.getCanvas().style.cursor = "pointer"; });
        map.on("mouseleave", "opps-layer", () => { map.getCanvas().style.cursor = ""; });

        // Fit bounds to data
        const coords = data.features.map(f => f.geometry.coordinates);
        const bounds = coords.reduce(
          (b, c) => b.extend(c),
          new mapboxgl.LngLatBounds(coords[0], coords[0])
        );
        map.fitBounds(bounds, { padding: 40 });
      });
  });
</script>
</body>
</html>
